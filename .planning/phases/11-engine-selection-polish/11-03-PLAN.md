---
phase: 11-engine-selection-polish
plan: 03
type: execute
wave: 3
depends_on: ["11-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Voice mode works on Android Chrome without notification beep (PRIMARY GOAL)"
    - "Voice mode works offline on Android after model download"
    - "Voice mode works on iOS Safari with Web Speech API"
    - "Voice mode works on Desktop Chrome/Firefox/Safari"
    - "Recognition accuracy acceptable for teleprompter use"
  artifacts: []
  key_links: []
---

<objective>
Validate cross-platform functionality with focus on Android beep elimination (primary v1.2 milestone goal) and verify offline capability, fallback behavior, and recognition accuracy across target platforms.

Purpose: Confirm the entire v1.2 milestone delivers on its core promise: beep-free voice control on Android via offline Vosk processing.

Output: Validated cross-platform compatibility with documented test results for Android, iOS, and Desktop browsers.
</objective>

<execution_context>
@/Users/brent/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/11-engine-selection-polish/11-RESEARCH.md
@.planning/phases/11-engine-selection-polish/11-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete engine selection system with Vosk offline recognition and Web Speech API fallback. The primary goal of v1.2 is to eliminate the Android notification beep by using Vosk's offline processing instead of Web Speech API's cloud-based recognition.

Key features to verify:
- Engine selection UI with Auto/Vosk/Web Speech options
- Automatic fallback when Vosk unavailable
- Model download with progress tracking
- Settings persistence across sessions
- Engine indicator showing active engine
- Cross-platform compatibility
  </what-built>

  <how-to-verify>
**CRITICAL TEST 1: Android Beep Elimination (PRIMARY GOAL)**

Platform: Android Chrome (real device required - Pixel, Samsung, etc.)

Steps:
1. Visit the app URL on Android Chrome (served over HTTPS with COOP/COEP headers)
2. Open Settings → Verify "Vosk (Offline)" option is available and NOT disabled
3. Select "Vosk (Offline)" if not already selected
4. Click "Download for Offline Use" button
5. Wait for model download to complete (progress bar should reach 100%)
6. Verify model cached (settings should show "Cached: ~40MB (date)")
7. Close settings, return to teleprompter
8. Click Voice button to enable voice mode
9. Wait for "Listening" indicator to appear
10. **CRITICAL**: Check notification tray - Is there a microphone notification beep/icon?
11. Speak a few words from the script
12. Verify text highlights and teleprompter scrolls
13. **VERIFY**: No notification beep occurred at step 10

Expected result: Voice mode activates WITHOUT Android notification beep. This confirms Vosk offline processing avoids the system notification.

If beep STILL occurs: The v1.2 milestone has FAILED its primary goal. Document this in summary and escalate.

---

**TEST 2: Offline Capability (Android)**

Prerequisites: Complete TEST 1 (model cached)

Steps:
1. Enable Airplane Mode on Android device
2. Return to app (may need to reload cached page)
3. Verify settings show "Vosk (Offline)" selected and model cached
4. Click Voice button
5. Speak from script
6. Verify voice recognition works WITHOUT internet connection

Expected result: Voice mode works offline. Teleprompter scrolls based on speech.

---

**TEST 3: iOS Safari Fallback**

Platform: iOS Safari (iPhone or iPad)

Steps:
1. Visit app on iOS Safari (HTTPS)
2. Open Settings → Verify "Vosk (Offline)" option is DISABLED or hidden
3. Verify help text explains: "iOS Safari does not support Vosk (SharedArrayBuffer unavailable)"
4. Verify "Web Speech API (Online)" is selected automatically
5. Close settings
6. Click Voice button
7. Grant microphone permission when prompted
8. Verify voice mode works using Web Speech API
9. Speak from script
10. Verify text highlights and scrolls

Expected result: Vosk unavailable on iOS, automatic fallback to Web Speech API works correctly.

---

**TEST 4: Desktop Browser Compatibility**

Platforms: Chrome, Firefox, Safari (macOS/Windows)

For each browser:
1. Visit app (localhost with HTTPS for COOP/COEP headers)
2. Open DevTools Console
3. Check console for: SharedArrayBuffer availability message
4. Open Settings → Note which engines are available
5. If Vosk available: Select Vosk, download model, test voice mode
6. If Vosk unavailable: Verify Web Speech API fallback
7. Verify voice mode works (highlight, scroll)
8. Test settings persistence: Change font size → reload → verify persisted

Chrome expected: Vosk available (if COOP/COEP headers correct)
Firefox expected: Vosk available (if COOP/COEP headers correct)
Safari expected: Vosk may be unavailable (SharedArrayBuffer restrictions), Web Speech API fallback

---

**TEST 5: Engine Switching**

Platform: Any browser where both engines work (Desktop Chrome ideal)

Steps:
1. Start with Vosk selected, voice mode active
2. Speak a few words → verify working
3. Stop voice mode
4. Open Settings → Switch to "Web Speech API"
5. Close settings
6. Enable voice mode again
7. Speak a few words → verify working
8. Verify script content and scroll position preserved
9. Open Settings → Switch back to Vosk
10. Repeat test
11. Reload page → verify engine preference persisted

Expected result: Switching engines works without losing script or position. Preference persists.

---

**TEST 6: Recognition Accuracy**

Platform: Any working platform

Steps:
1. Use sample script with ~200 words
2. Enable voice mode
3. Read script naturally (NOT word-for-word perfect)
4. Allow natural pauses, variations, "um"s, etc.
5. Note how many words matched correctly vs mismatches
6. Calculate approximate word error rate

Expected result: >80% of words matched correctly (acceptable for teleprompter use). Fuzzy matching handles minor variations.

If accuracy <80%: Document issues. May need Vosk model tuning or matching threshold adjustments.

---

**TEST 7: Model Cache Management**

Platform: Any browser with Vosk support

Steps:
1. Open Settings → Verify model cached
2. Note cache size and date
3. Click "Clear Cached Model" button
4. Verify cache status changes to "Not cached"
5. Close and reopen settings
6. Verify still shows "Not cached" (persisted)
7. Click "Download for Offline Use" again
8. Verify download completes
9. Reload page
10. Open settings → Verify model cached again

Expected result: Cache management works. Model deletion and re-download successful.

---

**TEST 8: Error Handling**

Platform: Any browser

Error scenarios to test:
1. **No microphone permission**: Deny permission → verify error UI with retry option
2. **Network failure during download**: Disconnect during model download → verify error message
3. **Vosk initialization failure**: (Simulate if possible) → verify fallback to Web Speech API with reason
4. **Private browsing mode**: Open in private/incognito → verify settings don't crash (fall back to defaults)

Expected result: Clear error messages, graceful fallbacks, no crashes.

---

**TEST 9: Performance on Constrained Devices**

Platforms: Older Android (e.g., Pixel 3a), older iPhone (e.g., iPhone SE)

Steps:
1. Run same tests as above on older device
2. Monitor performance:
   - Model download time (should complete in <60s on 4G)
   - Voice mode latency (should be <500ms speech to highlight)
   - Memory usage (should not cause browser crashes)
   - Battery drain (note if excessive)

Expected result: App performs acceptably on constrained devices. Some slowdown acceptable but no crashes.

---

**PASS/FAIL Criteria:**

CRITICAL (must pass for v1.2 success):
- ✓ Android beep eliminated when using Vosk (TEST 1)
- ✓ Offline mode works on Android (TEST 2)

HIGH PRIORITY (should pass):
- ✓ iOS Safari fallback works (TEST 3)
- ✓ Desktop browsers work (TEST 4)
- ✓ Engine switching works (TEST 5)
- ✓ Recognition accuracy >80% (TEST 6)

MEDIUM PRIORITY (nice to have):
- ✓ Cache management works (TEST 7)
- ✓ Error handling graceful (TEST 8)
- ✓ Constrained devices usable (TEST 9)
  </how-to-verify>

  <resume-signal>
After completing all tests, report results:

**Format:**
```
ANDROID BEEP TEST: [PASS/FAIL]
Details: [Beep occurred? Yes/No. Which Android version/device?]

OFFLINE TEST: [PASS/FAIL]
Details: [Worked offline? Any issues?]

IOS SAFARI TEST: [PASS/FAIL]
Details: [Fallback worked? Any issues?]

DESKTOP TESTS:
- Chrome: [PASS/FAIL]
- Firefox: [PASS/FAIL]
- Safari: [PASS/FAIL]

ENGINE SWITCHING: [PASS/FAIL]

RECOGNITION ACCURACY: [%] ([PASS/FAIL])

CACHE MANAGEMENT: [PASS/FAIL]

ERROR HANDLING: [PASS/FAIL]

PERFORMANCE: [PASS/FAIL]

OVERALL v1.2 STATUS: [SUCCESS/FAILED]

Notes: [Any additional observations, issues found, etc.]
```

If Android beep test FAILS: The v1.2 milestone has failed its primary goal. We need to either:
1. Investigate whether Vosk setup is incorrect
2. Consider alternative approaches (native app wrapper, different offline engine)
3. Accept limitation and document

Type "approved" if all CRITICAL tests pass, or paste test results for review.
  </resume-signal>
</task>

</tasks>

<verification>
This plan is entirely human verification. No automated verification needed.

The checkpoint includes comprehensive test scenarios covering:
- Primary goal: Android beep elimination (CRITICAL)
- Secondary goal: Offline capability (CRITICAL)
- Fallback behavior (iOS, older browsers)
- Cross-platform compatibility (Desktop Chrome/Firefox/Safari)
- Engine switching and settings persistence
- Recognition accuracy for teleprompter use
- Error handling and edge cases
- Performance on constrained devices

Results will determine v1.2 milestone success.
</verification>

<success_criteria>
- Android beep test PASSED (no notification beep when using Vosk)
- Offline test PASSED (voice mode works without internet after model download)
- iOS Safari fallback PASSED (Web Speech API works when Vosk unavailable)
- Desktop browsers PASSED (at least Chrome and Firefox work)
- Engine switching PASSED (can switch without losing state)
- Recognition accuracy >80% (acceptable for teleprompter use)
- All error scenarios handled gracefully (no crashes)
- Constrained devices perform acceptably (no crashes, <500ms latency)
- Satisfies VALID-01, VALID-02, VALID-03, VALID-04, VALID-05, VALID-06, VALID-07
- **v1.2 MILESTONE SUCCESS confirmed if Android beep eliminated**
</success_criteria>

<output>
After completion, create `.planning/phases/11-engine-selection-polish/11-03-SUMMARY.md`

Include test results in summary:
- Which tests passed/failed
- Android beep test outcome (CRITICAL)
- Any issues discovered
- Performance observations
- Recommendations for future improvements
</output>
