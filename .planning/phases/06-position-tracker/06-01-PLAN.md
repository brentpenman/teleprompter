---
phase: 06-position-tracker
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - matching/PositionTracker.js
  - matching/PositionTracker.test.js
autonomous: true

must_haves:
  truths:
    - "confirmedPosition only moves forward (never backward automatically)"
    - "High-confidence match near current position advances confirmedPosition"
    - "Low-confidence match does not advance confirmedPosition"
    - "Backward match is ignored (position holds)"
    - "getScrollBoundary returns confirmedPosition for external code"
  artifacts:
    - path: "matching/PositionTracker.js"
      provides: "Stateful position management class"
      exports: ["PositionTracker"]
      min_lines: 80
    - path: "matching/PositionTracker.test.js"
      provides: "Core position tracking tests"
      min_lines: 60
  key_links:
    - from: "matching/PositionTracker.js"
      to: "matching/WordMatcher.js"
      via: "MatchCandidate type from processMatch input"
      pattern: "processMatch.*candidate"
---

<objective>
Implement the core PositionTracker class with two-position model (confirmedPosition + candidatePosition), monotonic constraint, and basic confirmation logic.

Purpose: PositionTracker is the single source of truth for position in the v1.1 pipeline. It receives match candidates from WordMatcher and decides when to advance position. This plan establishes the foundational tracking behavior without skip detection (covered in 06-02).

Output: Working PositionTracker class with TDD tests proving monotonic forward movement and confidence-based confirmation.
</objective>

<execution_context>
@/Users/brent/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-position-tracker/06-CONTEXT.md
@.planning/phases/06-position-tracker/06-RESEARCH.md

@matching/WordMatcher.js
</context>

<feature>
  <name>Core PositionTracker with Two-Position Model</name>
  <files>matching/PositionTracker.js, matching/PositionTracker.test.js</files>
  <behavior>
    PositionTracker maintains two internal positions:
    - confirmedPosition (floor): stable, only moves forward on high-confidence matches
    - candidatePosition (ceiling): exploratory, tracks potential matches

    Interface:
    - constructor(options) - accepts confidenceThreshold (default 0.7), nearbyThreshold (default 10)
    - getConfirmedPosition() - returns confirmedPosition
    - getScrollBoundary() - returns confirmedPosition (same as above, for external code)
    - processMatch(candidate) - applies confirmation logic, returns ProcessResult
    - reset() - resets both positions to 0

    ProcessResult shape:
    { action: 'advanced'|'hold'|'exploring', confirmedPosition: number, candidatePosition?: number }

    MatchCandidate (input from WordMatcher):
    { position: number, startPosition: number, matchCount: number, combinedScore: number, startOffset: number, endOffset: number }

    Confirmation rules (for this plan - nearby matches only):
    1. Ignore matches with combinedScore < confidenceThreshold
    2. Ignore backward matches (position < confirmedPosition)
    3. For nearby matches (distance <= nearbyThreshold): single high-confidence match advances position
    4. confirmedPosition ONLY moves forward (monotonic constraint)

    Test cases:
    - HIGH: position=10, combinedScore=0.9, nearby -> advances to 10
    - LOW: position=10, combinedScore=0.5 -> holds (low confidence)
    - BACKWARD: position=5 when confirmedPosition=10, combinedScore=0.95 -> holds (backward)
    - RESET: reset() -> confirmedPosition=0, candidatePosition=0
  </behavior>
  <implementation>
    1. Create test file with failing tests for:
       - Constructor initializes positions to 0
       - getConfirmedPosition returns confirmedPosition
       - getScrollBoundary returns confirmedPosition
       - processMatch advances on high-confidence nearby match
       - processMatch holds on low-confidence match
       - processMatch holds on backward match (monotonic)
       - reset() resets all state

    2. Implement PositionTracker class to pass tests:
       - ES module with class export
       - Store confirmedPosition, candidatePosition as instance properties
       - processMatch checks confidence threshold, forward constraint, then updates
       - Return ProcessResult with action type

    3. Add JSDoc types matching WordMatcher pattern:
       - @typedef ProcessResult
       - @param and @returns for all methods
  </implementation>
</feature>

<verification>
```bash
# Run tests
npm test -- matching/PositionTracker.test.js

# All tests pass
# Verify exports
node -e "import('./matching/PositionTracker.js').then(m => console.log('Exports:', Object.keys(m)))"
```
</verification>

<success_criteria>
- PositionTracker.test.js has 6+ tests covering core behavior
- All tests pass
- PositionTracker class exports from matching/PositionTracker.js
- Monotonic constraint verified (backward match does not move position)
- Confidence threshold verified (low score does not advance)
- Skip detection logic NOT included (deferred to 06-02)
</success_criteria>

<output>
After completion, create `.planning/phases/06-position-tracker/06-01-SUMMARY.md`
</output>
